<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NVDA Forecast — Simple App</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0b0e14; --card:#121826; --text:#eaeefb; --muted:#94a3b8; --accent:#7e3ff2; }
    body { margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; background:var(--bg); color:var(--text); }
    .wrap { max-width:900px; margin:40px auto; padding:0 16px; }
    h1 { margin:0 0 16px; font-size:28px; }
    .card { background:var(--card); border:1px solid #1f2937; border-radius:12px; padding:16px; }
    .grid { display:grid; gap:16px; grid-template-columns:repeat(auto-fit, minmax(260px,1fr)); }
    label { font-weight:600; font-size:14px; display:block; margin:8px 0 6px; color:#cbd5e1; }
    select, textarea, input { width:100%; box-sizing:border-box; border-radius:8px; border:1px solid #334155; background:#0f172a; color:var(--text); padding:10px; }
    textarea { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; resize:vertical; min-height:120px; }
    .btn { display:inline-block; border:0; border-radius:10px; padding:12px 16px; background:var(--accent); color:white; font-weight:700; cursor:pointer; }
    .btn[disabled] { opacity:.6; cursor:not-allowed; }
    .muted { color:var(--muted); font-size:13px; }
    .row { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    ul { margin:8px 0 0 18px; padding:0; }
    .error { color:#ff6b6b; white-space:pre-wrap; }
    .ok { color:#22c55e; }
    .footer { margin-top:18px; color:#9aa5b1; font-size:12px; }
    code { background:#0f172a; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>NVDA Forecast — Simple App</h1>
    <div class="grid">
      <div class="card">
        <label>API URL</label>
        <input id="api" value="https://nvda-api.onrender.com" />
        <div class="muted">If you redeploy the backend, update this.</div>

        <div class="row" style="margin-top:12px;">
          <div style="flex:1; min-width:140px">
            <label>Tag / View</label>
            <select id="tag">
              <option value="A">A (NVDA only)</option>
              <option value="B" selected>B (All)</option>
              <option value="AFF">AFF (Affiliates)</option>
            </select>
          </div>
          <div style="flex:1; min-width:140px">
            <label>Framework</label>
            <select id="fw">
              <option value="lgbm" selected>LightGBM</option>
              <!-- you can add lstm/bilstm if you deploy those models -->
            </select>
          </div>
        </div>

        <label style="margin-top:10px;">Input matrix (CSV or JSON) — we’ll use the last row for LightGBM</label>
        <textarea id="raw">0.12,0.03,0.45,0.20
0.10,0.04,0.44,0.18
0.08,0.05,0.46,0.22</textarea>
        <div class="muted">CSV rows OR a JSON array like <code>[[0.12,0.03,0.45,0.20],[...]]</code>.</div>

        <div class="row" style="margin-top:12px;">
          <button id="go" class="btn">Predict (Regression)</button>
          <div id="busy" class="muted"></div>
        </div>

        <div id="err" class="error"></div>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px;">Result</h3>
        <div id="result" class="muted">No result yet.</div>
        <div class="footer">Tip: <code>/health</code> should return <code>{"status":"ok"}</code>.</div>
      </div>
    </div>
  </div>

  <script>
    function parseMatrix(text) {
      const t = text.trim();
      if (!t) throw new Error("Please paste some values.");
      if (t.startsWith("[")) {
        const X = JSON.parse(t);
        if (!Array.isArray(X) || !Array.isArray(X[0])) {
          throw new Error("JSON must be a 2D array [T,F].");
        }
        return X;
      }
      const rows = t.split(/\r?\n/).map(r =>
        r.split(/[,\s]+/).filter(Boolean).map(Number)
      ).filter(r => r.length > 0);
      if (!rows.length) throw new Error("No rows found.");
      return rows;
    }

    async function predict() {
      const api = document.getElementById('api').value.trim().replace(/\/+$/, '');
      const tag = document.getElementById('tag').value;
      const fw  = document.getElementById('fw').value;
      const raw = document.getElementById('raw').value;

      const errEl = document.getElementById('err');
      const resEl = document.getElementById('result');
      const busy  = document.getElementById('busy');
      const btn   = document.getElementById('go');

      errEl.textContent = "";
      resEl.textContent = "No result yet.";
      busy.textContent = "Calling API…";
      btn.disabled = true;

      try {
        const Xfull = parseMatrix(raw);
        const X = (fw === 'lgbm') ? [ Xfull[Xfull.length - 1] ] : Xfull;

        const r = await fetch(`${api}/predict/regression`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ tag, framework: fw, X })
        });
        const data = await r.json();
        if (!r.ok) throw new Error(JSON.stringify(data));

        resEl.innerHTML = `
          <div class="ok"><b>Success</b></div>
          <ul>
            <li><b>Framework:</b> ${data.framework}</li>
            <li><b>Tag:</b> ${data.tag}</li>
            <li><b>Prediction (y_pred):</b> ${data.y_pred}</li>
            ${data.scaled ? `<li><b>Note:</b> ${data.note}</li>` : ``}
          </ul>
        `;
      } catch (e) {
        errEl.textContent = e.message || String(e);
      } finally {
        busy.textContent = "";
        btn.disabled = false;
      }
    }

    document.getElementById('go').addEventListener('click', predict);
  </script>
</body>
</html>
